<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>AvNav OCharts</title>
    <link href="../styles.css" rel="stylesheet" type="text/css">
  </head>
  <body data-order="700" class="fimage">
    <h1>Avnav Ocharts(NG)</h1>
    <div class="toc" data-maxlevel="3"></div>
    <p>AvNav ochartsng is a new implementation of the <a href="ocharts.html">AvNav
        ocharts plugin</a>.<br>
      This implementation has a couple of new features:</p>
    <ul>
      <li>Now also available on Android (see <a href="#android">below</a>)</li>
      <li>Has a direct (online) Shop interface</li>
      <li>Can now also handle unencrypted S57 charts (after some initial <a href="#chartconversions">
          conversion</a>)</li>
      <li>Has more options for adapting the display</li>
      <li>Avoids the large disk caches that created a lot of SD card write load
        and a lot of CPU load</li>
      <li>Does not need to restart to handle newly uploaded charts</li>
      <li>Can utilize more cores of the processors and should run faster on many
        systems</li>
      <li>Has fewer external dependencies - especially it does not need a
        working X11 environment any more</li>
      <li>Utilizes less memory</li>
    </ul>
    <p><a name="restrictions"></a>The new version has some restrictions:</p>
    <ul>
      <li>Handling of oeRNC charts (raster charts) is not implemented</li>
      <li>On Android you cannot use the same license for OpenCPN and for AvNav</li>
      <li>On Linux installations with OpenCPN and AvNav (like OpenPlotter) you
        cannot directly use the charts that are installed at OpenCPN (as OpenCPN
        has no documented interface to find out the installation location).
        Instead you must upload them to the plugin (although you will use the
        same key).</li>
    </ul>
    <h2>Overview</h2>
    <div class="toc"> </div>
    <p>AvNav is able to handle charts in various raster formats. So far it was
      unable to handle any commercial charts. The&nbsp; <a href="https://o-charts.org/">o-charts</a>
      company supplies charts for various regions of the world for usage in
      OpenCPN.</p>
    <p>After some agreements with o-charts, those charts can now also be used
      for AvNav (starting with version 2024xxx with this new plugin - <a href="#Installation">see
        below</a>). At present you can use oeusenc vector-charts .</p>
    <p>Additionally the plugin is able to handle free S57 charts (after <a href="#chartconversions">conversion</a>).</p>
    <p>To display those charts in AvNav they must be rendered into raster
      images. This is handled by a new plugin for AvNav(avnav-ochartsng). The
      rendering takes place on the fly whenever tiles are to be displayed. A
      certain amount of rendered chart data (tiles) is kept in memory on the
      server to serve them fast if you switch between certain zoom levels or if
      you run multiple displays.</p>
    <p>All oeSENC charts handling is performed by the plugin - including
      installation (you cannot install them directly via the <span style="color: #0000ee;">d</span><a
        href="../userdoc/downloadpage.html">ownload page</a>). For this purpose
      a dedicated GUI is offered by the plugin. You enter it from the main page
      via <img src="../viewerimages/icons-new/apps.svg" alt="" class="inlineimage">(User
      Apps) and&nbsp; Ocharts-Provider&nbsp; <img src="ochartsngicon.png" alt=""
        class="inlineimage">.</p>
    <p> <img src="ochartsng-gui1.png" class="fimage"></p>
    <br>
    <h2>Chart Types</h2>
    <p>AvNav ochartsng can handle the o-charts vector charts (oeusenc) as
      described in this document.<br>
      Additionally it can also handle unencrypted vector charts - like S57
      charts available for download for various regions.<br>
      To use S57 charts they need to be converted into the OpenCPN format that
      AvNav-ochartsng understands. <br>
      For details on how to convert charts refer to <a href="#chartconversions">Chart
        Conversions</a>.</p>
    <h2><a name="Charts"></a>Buying and Installing the Charts</h2>
    <p>Important Hint: <span style="color: #ff6666;">If you do not have a
        dongle from o-charts, your chart license is bound to your system. So in
        case of any trouble <b>do not</b> set up a new system (by writing an
        image to an SD card) but instead try to repair the system. If you set up
        a new system you will lose your license. I will by happy to support in
        case of trouble - contact e.g. via <a href="mailto:andreas@wellenvogel.net">email</a>.</span></p>
    <p>To be able to buy charts at o-charts you have to create an account at <a
        href="https://o-charts.org/shop/en/autenticacion?back=my-account">their
        site</a> first.<br>
      Afterwards you have to register the systems you would like to buy charts
      for <a href="https://o-charts.org/shop/en/8-oesenc">at the o-charts site</a>.<br>
      You have two different ways to do this - named the "<a href="https://o-charts.org/manuals/?lng=en">online
        process</a> " and the <a href="https://o-charts.org/manuals/offline.php?lng=en">"Offline"
        process</a> . <br>
      The online process requires that your system (the one running the AvNav
      server - not necessarily the one running the browser!) is connected to the
      internet.<br>
      For Android the registration of the system is only possible with the
      online process.</p>
    <h3><a name="offlineprocess"></a>The Offline Process</h3>
    <p>This process consists of the following steps:</p>
    <ol>
      <li>Create a "fingerprint" for the system you would like to use the charts
        at. In AvNav you will create it in the GUI for the plugin and download
        from there.</li>
      <li>Upload the fingerprint to o-charts and create a system (basically
        assigning a name).</li>
      <li>Buy charts</li>
      <li>Assign charts to the system you created</li>
      <li>After a short time you will receive an email from o-charts with a
        download link (zip file).</li>
      <li>Upload charts to AvNav (via the plugin GUI).</li>
    </ol>
    <p>For updates repeat steps 4, 5 and 6 (only requesting the notification
      mail at step 4).<br>
      For further chart sets steps 3-6.<br>
      For steps 2,3,4 and 5 you need a system with internet connectivity. You
      can e.g. use a laptop or an android device.<span style="color: red;"><br>
        Important hint for Android</span>: The registration of the system (Steps
      1 and 2) cannot be handled using the offline process. You have to use the
      <a href="#onlineprocess">online process</a> for those steps. Buying
      charts, assigning them, downloading and installing them can be also done
      with the offline process. </p>
    <p>I created a <a href="https://www.youtube.com/watch?v=q24VRAtbbEE">video</a>
      to demonstrate the offline process. Additionally here is a short
      description.</p>
    <p><b>Hint</b>: If the charts are already registered on the same system (for
      OpenCPN) you can directly continue at step 6 (but not for android - see <a
        href="#restrictions">restrictions</a> above). </p>
    <h4>Creating the fingerprint</h4>
    <p>Via <img src="../viewerimages/icons-new/apps.svg" alt="" class="inlineimage">-&gt;<img
        src="ochartsngicon.png" class="inlineimage"> you enter the GUI of the
      plugin, select the "Charts" tab.</p>
    <img src="ochartsng-gui-charts1.png" class="fimage">
    <p>Use "Get Fingerprint" to create the fingerprint file. If you are using an
      o-charts dongle - just select the "Get Fingerprint(Dongle) button". This
      button will only be visible if a dongle has been detected (dongle line is
      green).</p>
    <p><img src="ochartsng-gui-charts2.png" class="fimage"></p>
    <p>Choose Download to save the created file on your device.</p>
    <h4>Uploading the fingerprints to o-charts</h4>
    <p>Enter the&nbsp; <a href="https://o-charts.org/shop/en/module/occharts/occhartsOesu">o-charts
        page</a> and upload the fingerprint.</p>
    <img src="ocharts-buying.png" alt="" class="fimage">
    <p>With "Choose File" you select the file stored at step 2. Assign a
      meaningful name to the new system - this will be part of the mails you
      will receive later.</p>
    <h4>Buying the Charts</h4>
    <p>Select the desired charts from <a href="https://o-charts.org/shop/en/8-oesenc">oeSENC
        charts</a>.</p>
    <h4>Assigning to your System</h4>
    <img src="ocharts-assign.png" alt="" class="fimage">
    <p>At 1 you can assign charts to your system (in this screenshot this is not
      available anymore as the max amount of 2 systems are already assigned).
      The number of permitted systems has recently been increased to 5. At 2 you
      request the mail holding the download link (you would do the same for
      updates - in the screenshot: last version I have downloaded is 21, latest
      available is 23)</p>
    <h4>Downloading the Charts</h4>
    <img src="ocharts-download.png" alt="" class="fimage">
    <p>After a short time you will receive a mail containing the download link
      for your charts. Download the zip file.</p>
    <h4>Uploading the Zip File to AvNav</h4>
    <p><img src="ochartsng-upload1.png" class="fimage"></p>
    <p>In the plugin's GUI select "Upload Zip" to transfer the zip file
      downloaded in step 5 to AvNav.</p>
    <p>There will be a progress bar during upload.</p>
    <p><img src="ochartsng-upload2.png" class="fimage"></p>
    <p>After the upload is completed the zip file will be unpacked. Some initial
      checks can take some time.</p>
    <p>Unless configured otherwise, the charts will be uploaded to
      /home/pi/avnav/data/ocharts/charts.</p>
    <p> If the newly uploaded chart contains updates to an already existing set,
      the existing set will be deactivated. You may change this later on by
      using Enable/Disable/Auto. Chart sets not required anymore can be deleted.
    </p>
    <p>Important hint: As the charts will only be available at the o-charts page
      as long as they are valid, you may want to keep the downloaded zip file at
      a safe place. AvNav OchartsNG can still upload and use those charts even
      after their validity period (but you will not receive any updates).</p>
    <p>After all charts are successfully read the status should change to green
      (READY).</p>
    <p><img src="ochartsng-upload4.png" class="fimage"></p>
    <p>If the status turns to "ERROR" (red) you maybe uploaded a zip that was
      not built for your current system. You can check details in the log file
      at /home/pi/avnav/data/ocharts/provider.log.</p>
    <p>Now the charts are available and can be used.</p>
    <p><img src="ocharts-mainpage.png" alt="" class="fimage"></p>
    <p><img src="ocharts-navpage.png" alt="" class="fimage"></p>
    <p><br>
    </p>
    <h3><a name="onlineprocess"></a>The Online Process</h3>
    <p>For using the online process your system (the server that runs AvNav -
      not necessarily the one that you run your browser on) needs internet
      connectivity.</p>
    <p>It will allow you to register your system, check if it is known in the
      ocharts shop, list charts or updates being available for download,
      download and install them.<br>
      Currently the buying process and the assignments of the charts have to be
      done on the o-charts web site. But the GUI will contain a link button to
      go there.<br>
      The AvNav ochartsng will not store any shop credentials. But as you run
      inside a browser you can easily use your browser to store the credentials
      (like you do on any other web site).</p>
    <p><span style="color: red;">Security hint</span>: Although the
      communication with the ocharts shop is secured by SSL the communication
      between your browser and the AvNav server is not. So when you are using
      the online process just be sure to work within a secured network (e.g.
      behind an LTE router or a mobile phone hotspot) - not within a public open
      Wifi network.</p>
    <p><img src="ochartsng-shop1.png" alt="" class="fimage"> </p>
    <p>When opening the "shop" tab you will not be logged in and you will see an
      info whether a dongle is active on your system or not. Via the "ShopPage"
      button you can directly access the o-charts web page (but better log in
      first...).</p>
    <p>With tapping "Login" you will login to the o-charts shop. </p>
    <p><img src="ochartsng-shoploggedin.png" alt="" class="fimage"></p>
    <p>When the shop already knows your current system the "Shop name" will be
      shown and the list of available charts/updates that have been assigned to
      your system (see <a href="#offlineprocess">OfflineProcess</a>) will be
      visible.<br>
      If a version in the shop is newer then your local version (or the chart is
      not locally available) you can immediately install it.</p>
    <p><img src="ochartsng-shopupdate.png" alt="" class="fimage"></p>
    <p><img src="ochartsng-shopdownload.png" alt="" class="fimage"></p>
    <p>After downloading the chart will be unpacked and can immediately be used.
      If it is an update for an existing chart set, the new version will become
      active but the old one will still be available (similar handling like
      uploading a chart zip file). On the chart tab you can later on delete the
      older version if you don't need this any more.</p>
    <p><span style="color: red;">Important hint</span>:<br>
      As the charts in the shop will only remain available for download as long
      as they are valid (one year) please store the charts additionally at a
      safe place. You can either do this from the shop website by requesting the
      charts (like in the offline process). Or you can download the chart set
      from the "charts" tab (Download button).</p>
    <p>If your system is still not known to the shop you are able to register it
      there.</p>
    <p><img src="ochartsng-shopunknown.png" alt="" class="fimage"></p>
    On linux systems you will be prompted for a system name but on android the
    system name is fixed and cannot be changed.<br>
    <p>After you registered your system you can click the "ShopPage" link and
      start assigning charts to your system. When coming back to the shop tab
      you need to tap "Refresh" to get the list of charts that have been
      assigned.</p>
    <p><br>
    </p>
    <h2><a name="MainSettings"></a>Adapting the Look and Feel</h2>
    <p>As the o-charts are vector charts you can adjust their look and feel.
      However some limitations must be considered:</p>
    <ol>
      <li>The modifications apply to the server's chart settings - so they will
        become effective for all displays.</li>
      <li>If you change the look and feel all data in the internal cache are
        wiped and the chart tiles must be rendered from scratch. So this will
        (potentially) introduce some delays on systems with less computing
        power.</li>
    </ol>
    <p>Changing display parameters is done in the plugin GUI(<img src="../viewerimages/icons-new/apps.svg"
        alt="" class="inlineimage">-&gt;<img src="ochartsngicon.png" class="inlineimage">),
      tab "Main Settings".</p>
    <img src="ochartsng-settings1.png" class="fimage">
    <p>If you change a setting (1) it will be displayed bold. Changes will only
      become effective when you click "Update Settings"(2).<br>
      When you changed the settings the chart display will be rebuilt. This will
      typically cause a small delay with no display at all.</p>
    <p>By selecting "Cancel" you can revert your changes. "Defaults" will reset
      to the built-in defaults. Most parameters are similar to the ones you find
      at&nbsp; <a href="https://opencpn.org/wiki/dokuwiki/doku.php?id=opencpn:opencpn_user_manual:options_setting">OpenCPN
        settings</a>.</p>
    <p>The following parameters are available.</p>
    <table width="100%" border="1">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Meaning</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>Show Text</td>
          <td>show text for chart objects</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Important Text Only</td>
          <td>hide less important text</td>
          <td>false</td>
        </tr>
        <tr>
          <td>Light Descriptions</td>
          <td>show descriptions for lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Depths</td>
          <td>show soundings</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Quality</td>
          <td>show extra objects indicating the quality</td>
          <td>false</td>
        </tr>
        <tr>
          <td>Chart Information Objects</td>
          <td>show informational objects</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Buoy/Light Labels</td>
          <td>show labels for buoys and lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>National text on chart</td>
          <td>show national text</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Lights</td>
          <td>show lights</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Show Anchor Info</td>
          <td>show anchoring information</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Color Scheme</td>
          <td>The color scheme to be used for the chart display</td>
          <td>DAY_BRIGHT</td>
        </tr>
        <tr>
          <td>Chart Bounds</td>
          <td>Show the chart bounding boxes</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Reduced Detail at Small Scale</td>
          <td>reduce details at lower zoom levels</td>
          <td>true</td>
        </tr>
        <tr>
          <td>De-Cluttered Text</td>
          <td>improve text positioning</td>
          <td>true</td>
        </tr>
        <tr>
          <td>Display Category</td>
          <td>Base, Standard, All, User Standard</td>
          <td>Standard</td>
        </tr>
        <tr>
          <td>Graphics Style</td>
          <td>Paper Chart, Simplified</td>
          <td>Paper Chart</td>
        </tr>
        <tr>
          <td>Boundaries</td>
          <td>Plain, Symbolized</td>
          <td>Plain</td>
        </tr>
        <tr>
          <td>Colors</td>
          <td>4Color, 2 Color</td>
          <td>4 Color</td>
        </tr>
        <tr>
          <td>Text Font Size</td>
          <td>Scaling for text on charts</td>
          <td>1 (ca. 12px)</td>
        </tr>
        <tr>
          <td>Soundings Font Size</td>
          <td>Scaling for soundings</td>
          <td>1 (ca. 12px)</td>
        </tr>
        <tr>
          <td>Scale</td>
          <td>Base scaling. Higher values for more details on lower zoom levels</td>
          <td>1</td>
        </tr>
        <tr>
          <td>UnderZoom</td>
          <td>Number of zoom levels to downscale higher resolution chart tiles
            if no chart tile is available at the requested zoom level.</td>
          <td>4</td>
        </tr>
        <tr>
          <td>AreaUnder</td>
          <td>If with in the under zoom range still no charts have been found,
            just try some lower zoom layers - but only display the areas (land,
            depth) - no other information.<br>
            Be careful when increasing this as this could impact the performance
            a lot.</td>
          <td>2</td>
        </tr>
        <tr>
          <td>OverZoom</td>
          <td>Number of zoom levels to upscale a lower resolution chart tile if
            is no chart tile is available with better resolution.<br>
            <b>Hint</b>: Scale, UnderZoom and OverZoom, AreaUnder heavily
            influence the cost of the rendering process as they determine the
            number of charts to be processed to generate a single chart tile.
            Lower values normally mean less charts (i.e. being faster) - but
            there could be white areas between chart tiles. The defaults should
            be a good compromise.</td>
          <td>4</td>
        </tr>
        <tr>
          <td>Scale Tolerance</td>
          <td>When scaling the map or the symbols (symbol scale) all the symbols
            have to be rendered on those scaled values.<br>
            To avoid too much additional symbols you can allow a small tolerance
            here.</td>
          <td>0.1</td>
        </tr>
        <tr>
          <td>Rotation Tolerance</td>
          <td>When Objects (symbols, lines, lights... have to be rotated on the
            map for each different angle a new symbol has to be created. To
            optimize performance and memory usage we can allow a small tolerance
            here so that a couple of different angles can use the same rotated
            symbol (in degrees)</td>
          <td>2</td>
        </tr>
        <tr>
          <td>SymbolScale</td>
          <td>Scale the display of symbols. Some of the symbols are built from
            of raster data - so a scale &gt; 2 could already make theme look
            very ugly.</td>
          <td>1</td>
        </tr>
        <tr>
          <td>Depth</td>
          <td>Unit for soundings(Meters, Feet, Fathoms)</td>
          <td>Meters</td>
        </tr>
        <tr>
          <td>Shallow Depth</td>
          <td>Adjust to your needs</td>
          <td>2</td>
        </tr>
        <tr>
          <td>Safety Depth</td>
          <td>Adjust to your needs</td>
          <td>3</td>
        </tr>
        <tr>
          <td>Deep Depth</td>
          <td>Adjust to your needs</td>
          <td>5</td>
        </tr>
      </tbody>
    </table>
    <p>At the tab "Detail Settings" you can switch on/off particular chart
      features. Those detail settings will only become effective when using the
      display category "User Standard".</p>
    <h2><a name="featureinfo"></a>Feature Info (Object Query)</h2>
    <p>When you click on the chart a list of features (charts, overlays,
      AIS-objects and more) around this point is displayed. Selecting the chart
      from the list opens the chart's Feature Info window.</p>
    <img src="FeatureInfo-OCharts1.png" alt="" class="fimage">
    <p>By clicking "Info" you can view the raw information from the chart.</p>
    <p><img src="ochartsng-featureinfo2.png" class="fimage"> </p>
    <p> By clicking the blue chart name you can get some more information about
      the chart that this object belongs to.</p>
    <p> <img src="ochartsng-featureinfo3.png" alt="" class="fimage"> </p>
    Clicking the button "Charts" will bring up a list of charts that have been
    used at this point.<br>
    With the checkbox "RenderedOnly" you can decide to only list chart objects
    that currently have been drawn at the display (otherwise all chart objects
    near your click point will be shown).
    <h2><a name="Installation"></a>Installation</h2>
    <h3>Linux/Raspberry</h3>
    <p>The plugin is available as a debian package.<br>
      The packages are part of the official repositories.</p>
    <p>For the <a href="../install.html#Headless">AvNav Images</a>&nbsp; you
      can install the package normally with the avnav updater:</p>
    <ul>
      <li>avnav-ochartsng</li>
    </ul>
    <p>If you want to do this from the command line execute:</p>
    <ul>
    </ul>
    <div class="code">sudo apt-get update<br>sudo apt-get install avnav-ochartsng<br>sudo systemctl restart avnav</div>
    <p>If you are working on other images you should add the repository from
      free-x (adapt "bullseye" to your debian release):</p>
    <p>Refer to the <a href="../install.html#Packages">AvNav package install
        description</a>.</p>
    <div class="code">deb https://www.free-x.de/debpreview bullseye main contrib non-free</div>
    <p>Alternatively you can download the packages them from the <a href="../../downloads/daily-ochartsng">daily
        builds directory</a> or the <a href="../../downloads/release-ochartsng">release
        directory</a>.</p>
    <p>To use one of those packages just download and install the package
      (replace the version by the one you want): </p>
    <div class="code">cd /home/pi/avnav<br>wget -O avnav-ochartsng_20250624-raspbian-bullseye_armhf.deb https://www.wellenvogel.net/software/avnav/downloads/daily-ochartsng/20250624/avnav-ochartsng_20250624-raspbian-bullseye_arm64.deb<br>sudo apt install ./avnav-ochartsng_20250624-raspbian-bullseye_armhf.deb<br>sudo systemctl restart avnav</div>
    <h2><a name="Releases"></a></h2>
    <p> You can also download to a PC, transfer by scp/WinScp to the pi and
      install then. </p>
    <h4>AvNav-ocharts and AvNav-ochartsng Together</h4>
    <p>When you install the new avnav-ochartsng-plugin it will use the port 8083
      (which is different from the default port 8082 of the old plugin). Hint:
      If you installed a beta before 20250804 this uses port 8082 by default and
      you will get some conflict with the existing ocharts plugin. At the end
      both will try to use the same port - so at least one of the two will fail
      to start.<br>
      The old ocharts-plugin can be disabled on the&nbsp;<img src="../viewerimages/icons-new/status.svg"
        alt="" class="inlineimage"> <a href="../userdoc/statuspage.html">server/status
        page</a>.<br>
      By enabling the "useLegacy" switch in the <a href="#PluginConfig">PluginConfig</a>
      of the ochartsng plugin the new plugin will use all the charts that you
      installed with the old one.</p>
    <p>Running both in parallel should only be done if your system has
      sufficient RAM (at least 2GB).</p>
    <h3>Android</h3>
    <p>On android there is an extra app (avocharts) that will contain the
      ochartsng.</p>
    <p>See <a href="#android">AndroidApp</a> below.</p>
    <h2><a name="Releases"></a>Releases</h2>
    <p>You can find all releases and intermediate developer builds (daily
      builds) at:</p>
    <ul>
      <li><a href="../../downloads/release-ochartsng">Releases</a></li>
      <li><a href="../../downloads/daily-ochartsng">Daily Builds</a></li>
    </ul>
    <ul>
    </ul>
    <h3>Release Versions</h3>
    <p> <span style="font-weight: bold;">20250822</span> <a title="release/20250822"
        href="../../downloads/release-ochartsng/20250822">link</a></p>
    <p>Small Fixes and Working Directory selection for Android</p>
    <ul>
      <li><a href="https://github.com/wellenvogel/ochartsng/issues/27">#27</a>:
        Android: crash if started without notification permissions </li>
      <li><a href="https://github.com/wellenvogel/ochartsng/issues/28">#28</a>:
        Android: <a href="#workingdirectory">allow to use the external SD card</a>,
        improved diagnostics for the chart installer </li>
      <li><a href="https://github.com/wellenvogel/ochartsng/pull/29">#29</a>:
        build preparation for debian trixie </li>
    </ul>
    <p><span style="font-weight: bold;">20250812</span> </p>
    <p><i><b>Only Android Store - same content like 20250804 (only new version
          number).</b></i></p>
    <p> <span style="font-weight: bold;">20250804</span> <a title="release/20250804"
        href="../../downloads/release-ochartsng/20250804">link</a></p>
    <p><i><b>Initial Release</b></i></p>
    <ul>
      <li><b>Android</b>: <span style="color: red;">If you already have been
          using a beta version, please export the key there, enable "alt key" in
          the settings of the release version and import the key there. Only
          this way you will be able to download your charts from the store for
          the release version (or upload them after downloading a zip from the
          beta version). </span>Refer to the <a href="#androidbetarelease">hints</a>.
      </li>
    </ul>
    <h2><a name="License"></a>License Notes</h2>
    <p>Using the charts in AvNav with the oesenc-pi plugin has been agreed with
      o-charts and therefore is inline with their license conditions.<br>
      You have to agree to the <a href="https://o-charts.org/manuals/docs/EN_rrc_eula_ChartSetsForOpenCPN.html">license
        conditions</a> of <a href="https://o-charts.org/shop/en/content/3-our-conditions">o-charts</a><br>
      Especially it is not allowed to copy the charts or use them on other than
      the licensed systems.</p>
    <p>Access to the charts in AvNav is only possible from within the local net.
      You can connect at most 5 devices (Clients) at the same time.</p>
    <p>For software licenses see the <a href="https://github.com/wellenvogel/ochartsng/blob/master/Readme.md">Readme.</a></p>
    <h2><a name="PluginConfig"></a> Plugin Configuration</h2>
    <p>Linux only. For Android refer to <a href="#androidsettings">Android/Settings</a>.<br>
      Some of the plugins settings can be changed on the server/status page <img
        src="../viewerimages/icons-new/status.svg" alt="" class="inlineimage">
      at "plugins/system-ochartsng" .</p>
    <p><img src="ochartsng-edit-plugin.png" class="fimage"> </p>
    <p>Those are:</p>
    <table width="100%" border="1">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Meaning</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>port</td>
          <td>Http port </td>
          <td>8082</td>
        </tr>
        <tr>
          <td>debug</td>
          <td>log level for &lt;datadir&gt;/ocharts/provider.log.<br>
            &lt;datadir&gt; on a raspberry is /home/pi/avnav/data</td>
          <td>1</td>
        </tr>
        <tr>
          <td>memPercent</td>
          <td>The amount of memory (percent of the system memory) that the
            plugin (correctly: the provider process) will use. If this value is
            not set (or set to low) the provider will use an internal minimum.<br>
            This potentially could be rather low - especially when using raster
            charts. If it is very low the provider must open and close chart
            files very often and this will slow down it's operation. If you have
            enough memory (e.g. 2GB) you can increase speed by setting the
            memory to 1GB .</td>
          <td>50</td>
        </tr>
        <tr>
          <td>tileCachekb</td>
          <td>KB of memory to be used for the internal tile cache (set to 0 to
            disable it for some testing)</td>
          <td>40960</td>
        </tr>
        <tr>
          <td>useLegacy</td>
          <td>Also use the charts that have been installed with the old
            avnav-ocharts-plugin. By activating this you can disable the old
            plugin in the settings and just use all the charts you already
            installed.</td>
          <td>off</td>
        </tr>
      </tbody>
    </table>
    <h2><a name="Details"></a></h2>
    <h2><a name="android"></a>Android App</h2>
    <p>AvNav OchartsNG also runs on Android and provides charts for the <a href="../android/android.html">AvNav
        android app</a>.<br>
      The Ocharts support is built into a separate Android App - avocharts.</p>
    <p>Currently the app is not (yet) available in the google play store as it
      is still in beta status. So you need to download it from the <a href="../../downloads/daily-ochartsng">daily
        builds directory</a> and install it (allow external sources).</p>
    <p><img src="ochartsng-android-main.png" class="fimage"></p>
    <p>After you started up avocharts for the first time you can adapt some
      settings.<br>
      When you see this picture the real ocharts provider process is still not
      running - it will start up when you tap "start".</p>
    <p><a name="androidstartup"></a>Later it will not be necessary to start the
      avocharts app by hand - it should normally being started automatically
      when AvNav starts up. But directly starting the avocharts app can help to
      troubleshoot as you can get access to the output and log of the chart
      provider.<br>
      Please consider that the auto start will only work for apps of the same
      type - i.e. an AvNav release app can only start an avocharts release&nbsp;
      app and an AvNav beta app can only start an avocharts beta app.<br>
      So when you install the avocharts beta together with the "normal" AvNav
      app from the store you need to start avocharts by hand before you can use
      the charts in AvNav.</p>
    <h3><a name="androidsettings"></a>Settings</h3>
    <p>To adapt settings tap on the shown settings or on the settings icon on
      the upper right.</p>
    <p><img src="ochartsng-android-settings.png" class="fimage"></p>
    <br>
    <table width="100%" border="1">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Explanation</td>
          <td>Default</td>
        </tr>
        <tr>
          <td>Port</td>
          <td>The IP Port the provider process will use. If you get errors when
            you start the provider and see something like "address already in
            use" in the output (tapping the out button on the main page) you
            maybe need to change the port</td>
          <td>8082</td>
        </tr>
        <tr>
          <td>LogLevel</td>
          <td>0 - errors, 1- info, 2- debug</td>
          <td>1</td>
        </tr>
        <tr>
          <td>WorkDir</td>
          <td><a href="#workingdirectory">Location for storing all data</a> like
            charts and render settings(new since 20250822)</td>
          <td>internal</td>
        </tr>
        <tr>
          <td>Shutdown</td>
          <td>Time (in seconds) the provider will wait for a heartbeat from
            AvNav before it stops (only active when started by AvNav)</td>
          <td>30</td>
        </tr>
        <tr>
          <td>Memory</td>
          <td>Allowed Memory usage (%) of the system memory</td>
          <td>50</td>
        </tr>
        <tr>
          <td>Use alt key</td>
          <td>See below for the <a href="#androidbetarelease">hints</a> about
            Release/Beta Versions</td>
          <td><br>
          </td>
        </tr>
        <tr>
          <td>Disk symbol (upper right)</td>
          <td>Save your key (See below for the <a href="#androidbetarelease" style="color: black;">hints</a>
            about Release/Beta Versions)</td>
          <td><br>
          </td>
        </tr>
      </tbody>
    </table>
    <p>When done with the settings tap the back arrow.</p>
    <h3><a name="workingdirectory"></a>Working Directory (new since 20250822)</h3>
    <p>AvOcharts will store all charts, logs and the settings you can configure
      in Main Settings and Detailled Settings in a storage location on your
      device (Working Directory). This directory is independent from <a href="../android/android.html#workingdirectory">AvNav's
        working directory</a>.</p>
    <p>You have the following choices:</p>
    <p><img src="ochartsng-android-workdir.png" alt="" class="fimage"> </p>
    <p>Depending on the device you can select different locations where your
      data is stored (refer to the <a href="https://developer.android.com/training/data-storage/app-specific?hl=en">Android
        doc</a> for some technical background). If your device has an SD card
      you will see a selection like above:</p>
    <table style="width: 100%" border="1">
      <tbody>
        <tr>
          <td>Name</td>
          <td>Explanation</td>
        </tr>
        <tr>
          <td>Internal Storage</td>
          <td>This is a location in the internal flash memory of your device.
            It's completely private and (if your device is not rooted) is not
            accessible for other apps like a file manager.<br>
            The "*" in front of the entry shows that this directory was already
            used as working directory and contains data.</td>
        </tr>
        <tr>
          <td>External Storage</td>
          <td>This is a storage still being located in the internal flash memory
            but treated differently by the Android system (and therefore named
            "external - emulated"). Other apps can access this data location.<br>
            You can choose this location if you would like other apps (like a
            file manager) to access the data. The path for a file manager would
            typically be [internal
            memory]/Android/data/de.wellenvogel.ochartsprovider/files (or
            [internal
            memory]/Android/data/de.wellenvogel.avnav.ochartsprovider.beta/files
            for a beta version)</td>
        </tr>
        <tr>
          <td>External Storage-1</td>
          <td>This will only be visible if your device has an SD card installed.
            Typically you will also see "removable [SD Card]" as explanation.<br>
            If available this directory really is located on an external SD
            card. If you plan to use this, just be sure to always have the SD
            card installed, when you run AvNav (or avocharts). If you remove it
            while AvNav is running it could crash.<br>
            Other apps like a file manger can access the data.<br>
            The location is [SD
            card]/Android/data/de.wellenvogel.ochartsprovider/files (or [SD
            card]/Android/data/de.wellenvogel.ochartsprovider.beta/files).</td>
        </tr>
      </tbody>
    </table>
    <p>When you change the WorkDir all your data in the old WorkDir will become
      invisible to avocharts (although they remain available and you can switch
      back to the old one at any time).</p>
    <p>When avocharts starts up it checks if the selected working directory is
      still available (and will prompt you to choose a different one if not).<br>
      If you let it autostart from AvNav it will try to fall back to the
      internal working directory if the selected directory is not available
      (e.g. SD card removed).</p>
    <p>For the external directories you can in principle use a file manager to
      copy data to and from those locations but avocharts is not prepared to
      detect those data when it is running - so the preferred way&nbsp; is to
      upload data to those locations directly within the app. But you could e.g.
      create a zip of the data as a backup. And you can easily access the logs
      of avocharts.</p>
    <p>All the WorkDir directories will be emptied if you deinstall avocharts
      (or clean it's data).</p>
    <p>Important hint: Settings (i.e. the ones in the table above) are not
      stored in the WorkDir.<br>
    </p>
    <h3>Starting Up the first Time</h3>
    <p>You can now start the chart provider by tapping "START".</p>
    <p><img src="ochartsng-android-running.png" class="fimage"></p>
    <p>When the provider process is up and running you will see the indication
      in the notification bar. If something goes wrong just try to have a look
      at the output (tapping "OUT") or the log (tapping "LOG").</p>
    <p>Tapping "APP" will open up a browser window with the ochartsng app - the
      same view like you get from within AvNav.</p>
    <p><img src="ochartsng-android-webmain.jpg" alt="" class="fimage"></p>
    <p>You now can e.g. register at the ocharts shop (on android this is only
      possible using the Online Process).</p>
    <h3><a name="androidbetarelease"></a>Android Beta and Release Versions</h3>
    <p>Due to the way that the ocharts license daemon is working you will
      normally not be able to use charts that you installed with the release
      version within the beta version and vice versa.<br>
      To overcome this problem you can export the necessary information from the
      app version that you used to assign the charts and import this in the
      different version. Hint: You still can only use this on the same android
      device!<br>
      To export a key tap the disk symbol on the settings screen within the app
      and store the file at a safe place. When you later use the alternative
      version, select "use alternate key" , tap on the key value and import the
      saved key file there.<br>
      You can easily check if your app has the correct key by going to the shop
      page and log in. When the shop recognizes your current key it will show
      the system name - see <a href="#onlineprocess">Online Process</a>. </p>
    <p>Please also consider the <a href="#androidstartup">automatic startup
        relations</a> between the Beta and Release version.</p>
    <h2>Technical Details</h2>
    <p>The charts are provided by an executable that normally serves at port
      8082. <br>
      Communication with AvNav is handled by an AvNav <a href="plugins.html">plugin</a>
      on linux and by the avocharts app on Android.</p>
    <p>The GUI is a reactjs app that is also provided by the executable. It is
      integrated into AvNav as a <a href="../userdoc/addonpage.html">User App</a>.</p>
    <p>You will find the complete code at <a href="https://github.com/wellenvogel/ochartsng">GitHub</a>.</p>
    <p>You install into /usr/lib/avnav/plugins/ochartsng. The data directory is
      /home/pi/avnav/data/ochartsng. You can set some additional parameters for
      the AvNav plugin by editing <a href="configfile.html">avnav_server.xml</a>.
      Normally this is not necessary at all. </p>
    <p><a name="Upload"></a>You can separately set the directory for all
      settings and the charts: </p>
    <div class="code">&lt;AVNPluginHandler&gt;<br>...<br>&lt;system-ochartsng dataDir="$DATADIR/ochartsng"/&gt;<br>&lt;/AVNPluginHandler&gt;</div>
    <br>
    <p> </p>
    <h3> <a name="chartconversions"></a>Chart Conversions </h3>
    <p>Unencrypted vector charts like S57 charts have to be converted into the
      internally used "SENC" format before they can be handled.<br>
      There are 2 Options to convert such charts.</p>
    <h4>Converting with AvNav (since AvNav 20240520)</h4>
    <p>The avnav-ochartsng-plugin adds a chart converter to AvNav's <a href="../userdoc/importerpage.html">importer</a>.
      This converter contains a python script to convert S57 data into a zip
      archive that can be uploaded.<br>
      To convert your S57 charts simply upload a zip with the charts to AvNav's
      <a href="../userdoc/importerpage.html">importer</a> after you installed
      the plugin. <br>
      If you run AvNav and ochartsng on linux the converted charts will be
      automatically uploaded and activated to ochartsng.</p>
    <p>If you run ochartsng on a different system (e.g. on Android) you need an
      installation of AvNav either on a <a href="#Installation">linux machine</a>
      or on <a href="../install.html#Windows">Windows</a>.</p>
    <p>Ochartsng itself cannot run on Windows but the conversion tool can. So
      after you installed AvNav on Windows just open the "Update" Dialog and
      enter the Url of the ochartsng-s57 converter for Windows:</p>
    <ul>
      <li>release: <a href="https://www.wellenvogel.de/software/avnav/downloads/release-ochartsng/latest/ochartsng-latest.zip">https://www.wellenvogel.de/software/avnav/downloads/release-ochartsng/latest/ochartsng-latest.zip</a></li>
      <li>daily: <a href="https://www.wellenvogel.de/software/avnav/downloads/daily-ochartsng/latest/ochartsng-latest.zip">https://www.wellenvogel.de/software/avnav/downloads/daily-ochartsng/latest/ochartsng-latest.zip</a></li>
    </ul>
    <p>Afterwards let the conversion run and when finished download the
      converted chart (.zip). This zip can directly be uploaded to ochartsng
      both on linux and Android.</p>
    <h4>Converting using OpenCPN</h4>
    <p>If you already have a computer with OpenCPN up and running you can let
      OpenCPN convert the charts. To do so you need to activate the charts in
      OpenCPN. On the OpenCPN settings / tab "chart files" just click "Prepare
      all ENC Charts".</p>
    <p><img src="ochartsng-convert-opencpn.png" alt="" class="fimage"></p>
    <p>This will create a lot of files with the s57 extension in the OpenCPN
      directory (~/.opencpn on linux). Just pick the ones with similar names
      like your s57 charts, copy them in a new, empty directory with a name that
      explains the chart set. Afterwards create a text file "Chartinfo.txt" in
      this directory with just one line of text:</p>
    <p class="code">ChartInfo: nameOfTheChart</p>
    <p>Create a zip archive from this directory so that the zip archive has this
      directory inside. This archive can be uploaded to AvNav ochartsng.<br>
      On Linux there is a <a href="https://github.com/wellenvogel/ochartsng/blob/master/tools/collectS57.sh">script</a>
      to automate this collection process.</p>
  </body>
</html>
